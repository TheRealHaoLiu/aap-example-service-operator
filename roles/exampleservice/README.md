# ExampleService

This role handles the deployment of an example service that integrates with the AAP Gateway.

## Overview

The ExampleService operator deploys a Flask application and optionally registers it with the AAP Gateway using the PlatformServiceRegistration CRD. It demonstrates how to integrate a service with the AAP Gateway or run it standalone.

## Features

- Deploys a Flask application (quay.io/haoliu/dumb-flask-app:latest)
- Creates a Kubernetes Service to expose the Flask application
- Creates an OpenShift Route (if running on OpenShift)
- Optionally registers the service with the AAP Gateway using PlatformServiceRegistration
- When AAP integration is enabled, mounts the service secret generated by the PlatformServiceRegistration in the Flask application

## CRD Structure

The ExampleService CRD has the following structure:

```yaml
apiVersion: exampleservice.ansible.com/v1alpha1
kind: ExampleService
metadata:
  name: example-service
spec:
  aap_ref:
    name: myaap
    namespace: my-namespace  # Optional, defaults to the same namespace as the ExampleService
```

## Fields

### Optional Fields

- `aap_ref`: Reference to the AnsibleAutomationPlatform instance (optional)
  - `name`: Name of the AnsibleAutomationPlatform instance
  - `namespace`: Namespace of the AnsibleAutomationPlatform instance (optional, defaults to the same namespace as the ExampleService)

If `aap_ref` is not provided, the service will be deployed without registering with the AAP Gateway.

## Status

When an ExampleService is created, the following status fields are populated:

### With AAP Integration

```yaml
status:
  phase: Deployed
  platformServiceRegistration: example-service-psr
  serviceSecretName: example-service-psr-service-secret
  conditions:
    - type: Deployed
      status: "True"
      reason: ServiceDeployed
      lastTransitionTime: "2023-06-01T12:00:00Z"
      message: "Service has been deployed and registered with the AAP Gateway"
```

### Without AAP Integration

```yaml
status:
  phase: Deployed
  conditions:
    - type: Deployed
      status: "True"
      reason: ServiceDeployed
      lastTransitionTime: "2023-06-01T12:00:00Z"
      message: "Service has been deployed without AAP Gateway integration"
```

## Usage

### With AAP Integration

1. Create an AnsibleAutomationPlatform instance
2. Create an ExampleService instance referencing the AnsibleAutomationPlatform instance
3. The service will be registered with the AAP Gateway
4. A service secret will be generated and stored in a Kubernetes Secret
5. The Flask application will be deployed with the service secret mounted

### Without AAP Integration

1. Create an ExampleService instance without the `aap_ref` field
2. The Flask application will be deployed without AAP Gateway integration

## Example

See the example CR in `config/samples/exampleservice_v1alpha1_exampleservice.yaml`.
